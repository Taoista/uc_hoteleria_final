{% extends "layout.html" %}
{% load static %}


{% block content %}
<section class="page">
     <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
            <!-- ===  Page header === -->

            <div class="page-header" style="background-image:url({% static 'assets/images/header-1.jpg' %})">
                <div class="container">
                    <h2 class="title">Confirma tu reservacion</h2>
                    <p>Datos de reserva</p>
                </div>
            </div>

            <!-- ===  Step wrapper === -->

            <div class="step-wrapper">
                <div class="container">
                    <div class="stepper">
                        <ul class="row">
                            <li class="col-md-4 active">
                                <a href="reservation-1.html"><span data-text="Hotel y habitacion"></span></a>
                            </li>
                            <li class="col-md-4 active">
                                <a href="reservation-2.html"><span data-text="reservacion"></span></a>
                            </li>
                            <li class="col-md-4">
                                <a href="reservation-3.html"><span data-text="Checkout"></span></a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- ===  Checkout === -->

            <div class="checkout">

                <div class="container">

                    <div class="clearfix">

                        <!-- ========================  Note block ======================== -->

                        <div class="cart-wrapper">

                            <div class="note-block">

                                <div class="row">

                                    <!-- === left content === -->

                                    <div class="col-md-6">

                                        <!-- === login-wrapper === -->

                                        <div class="login-wrapper">

                                            <div class="white-block">

                                              
                                                <div class="login-block login-block-signup">

                                                    <div class="h4">Datos de reserva </div>

                                                    <hr />

                                                    <div class="row">

                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <input type="text" value="" class="form-control" placeholder="Nombre" id="nombre">
                                                            </div>
                                                        </div>

                                                        <div class="col-md-6">
                                                            <div class="form-group">
                                                                <input type="text" value="" class="form-control" placeholder="Apellido" id='apellido'>
                                                            </div>
                                                        </div>

                                                        <div class="col-md-12">

                                                            <div class="form-group">
                                                                <input type="email" value="" class="form-control" placeholder="correo" id="correo">
                                                            </div>
                                                        </div>

                                                        <div class="col-md-4">
                                                            <div class="form-group">
                                                                <input type="text" value="" class="form-control" placeholder="telefono" id="telefono">
                                                            </div>
                                                        </div>

                                                    </div>
                                                </div> <!--/signup-->
                                            </div>
                                        </div> <!--/login-wrapper-->
                                    </div> <!--/col-md-6-->
                                    <!-- === right content === -->

                                    <div class="col-md-6">


                                    </div>

                                </div>
                            </div>
                        </div>

                        <!-- ========================  Cart wrapper ======================== -->

                        <div class="cart-wrapper">

                            <!--cart header -->

                            <div class="cart-block cart-block-header clearfix">
                                <div>
                                    <span>Datos</span>
                                </div>
                                <div class="text-right">
                                    <span>Precio</span>
                                </div>
                            </div>

                            <!--cart items-->

                            <div class="clearfix">

                                <div class="cart-block cart-block-item clearfix">
                                    <div class="image">
                                        <a href="room-overview.html"><img src="{{ imagen_habitacion }}" alt="" /></a>
                                    </div>
                                    <div class="title">
                                        <div class="h2"><a href="room-overview.html">{{ nombre_hotel }} {{ nombre_habitacion }} </a></div>
                                        <div>
                                            <strong>Llegada</strong> <a href="#">({{ f_inicio }})</a>
                                        </div>
                                        <div>
                                            <strong>Termino</strong> <a href="#">({{ f_termino }})</a>
                                        </div>
                                        <div>
                                            <strong>Huesped</strong> {{ cantidad }}
                                        </div>
                                     
                                    </div>
                                    <div class="price">
                                        <span class="final h3">$ {{ precio }}</span>
                                        {% comment %} <span class="discount">$ 2.666</span> {% endcomment %}
                                    </div>
                                    <!--delete-this-item-->
                                    <span class="icon icon-cross icon-delete"></span>
                                </div>

                            </div>

                            <!--cart prices -->

                            <div class="clearfix">
                               
                            </div>

                            <!--cart final price -->

                            <div class="clearfix">
                                <div class="cart-block cart-block-footer cart-block-footer-price clearfix">
                                    <div>
                                        Promo code included!
                                    </div>
                                    <div>
                                        <span class="final h3">$ {{ precio }}</span>
                                    </div>
                                </div>
                            </div>


                            <!-- ========================  Cart navigation ======================== -->

                            <div class="clearfix">
                                <div class="cart-block cart-block-footer cart-block-footer-price clearfix">
                                    <div>
                                        <button class="btn btn-clean-dark btn-regresar">Regresar</button>
                                    </div>
                                    <div>
                                        <button class="btn btn-main btn-send-reservation">Reservar <span class="icon icon-chevron-right"></span></button>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>

                </div> <!--/container-->
            </div> <!--/checkout-->

        </section>


{% endblock %}


{% block content_js %}

<script>

    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    document.querySelector(".btn-regresar").addEventListener("click",()=>{
        window.history.back();
    })


    function checEmail(email){
        // Definir la expresión regular para un correo electrónico
        const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        
        // Testea el correo electrónico contra la expresión regular
        return re.test(email);
    }

    function checkNineDigitNumber(input) {
       // Verificar que la cadena tenga exactamente 9 caracteres
        if (input.length !== 8) {
            return false;
        }
        
        // Definir la expresión regular para al menos un dígito
        const containsNumber = /\d/;
        
        // Verificar que contenga al menos un número
        if (!containsNumber.test(input)) {
            return false;
        }

        // Verificar que no tenga más de 8 caracteres no numéricos
        const nonDigitCount = input.replace(/\d/g, "").length;
        if (nonDigitCount > 10) {
            return false;
        }
        
        return true;
    }


    const csrfToken = getCookie('csrftoken');

    {% comment %} ? enviar al formulario {% endcomment %}
    document.querySelector(".btn-send-reservation").addEventListener("click",()=>{

        // Obtener la fecha usando el método getDate()
       

        const formattedDateInicio = '{{ f_inicio }}'
        const formattedDateTermino = '{{ f_termino }}'
        var clientes = '{{ cantidad }}'

        let nombre = document.querySelector("#nombre").value
        let apellido = document.querySelector("#apellido").value
        let correo = document.querySelector("#correo").value
        let telefono = document.querySelector("#telefono").value

        if(nombre == "" || apellido == "" || correo == "" || telefono == ""){
            Swal.fire({
                title: "Error",
                text: "debe llenar los campos para continuar",
                icon: "error"
            });
            return false;
        }

        if(checEmail(correo)== false){
            Swal.fire({
                title: "Error email",
                text: "el email no es valido",
                icon: "error"
            });
            return false
        }

        if(checkNineDigitNumber(telefono) == false){
             Swal.fire({
                title: "Error telefono",
                text: "el telefono no es valido",
                icon: "error"
            });
            return false;
        }


        let form = document.createElement('form');
        form.method = 'POST';
        form.action = '{% url "create-reservation" %}';

        const f_inicio = document.createElement('input')
        f_inicio.type = 'hidden';
        f_inicio.name = 'f_inicio';
        f_inicio.value = formattedDateInicio;  // Reemplaza con el valor real

        const f_termino = document.createElement('input')
        f_termino.type = 'hidden';
        f_termino.name = 'f_termino';
        f_termino.value = formattedDateTermino;  // Reemplaza con el valor real

        let cantidad = document.createElement('input')
        cantidad.type = 'hidden';
        cantidad.name = 'cantidad';
        cantidad.value = clientes;  // Reemplaza con el valor real

        let id_hotel = document.createElement('input');
        id_hotel.type = 'hidden';
        id_hotel.name = 'id_hotel';
        id_hotel.value = '{{ id_hotel }}';

        let id_habitacion = document.createElement('input');
        id_habitacion.type = 'hidden';
        id_habitacion.name = 'id_habitacion';
        id_habitacion.value = '{{ id_habitacion }}';

        const csrfInput = document.createElement('input');
        csrfInput.type = 'hidden';
        csrfInput.name = 'csrfmiddlewaretoken';
        csrfInput.value = '{{ csrf_token }}';


        const input_nombre = document.createElement('input');
        input_nombre.type = 'hidden';
        input_nombre.name = 'nombre';
        input_nombre.value = nombre;

        const input_apellido = document.createElement('input');
        input_apellido.type = 'hidden';
        input_apellido.name = 'apellido';
        input_apellido.value = apellido;

        const input_correo = document.createElement('input');
        input_correo.type = 'hidden';
        input_correo.name = 'correo';
        input_correo.value = correo;

        const input_telefono = document.createElement('input');
        input_telefono.type = 'hidden';
        input_telefono.name = 'telefono';
        input_telefono.value = telefono;
        // ? agrego los elementos al formulario
        form.appendChild(f_inicio);
        form.appendChild(f_termino);
        form.appendChild(cantidad);
        form.appendChild(id_hotel);
        form.appendChild(id_habitacion);
        form.appendChild(csrfInput);
        form.appendChild(input_nombre);
        form.appendChild(input_apellido);
        form.appendChild(input_correo);
        form.appendChild(input_telefono);

        document.body.appendChild(form);

        form.submit();

      

    })


</script>

{% endblock %}

